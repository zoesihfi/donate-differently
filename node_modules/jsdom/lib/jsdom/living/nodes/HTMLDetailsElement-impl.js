"use strict";

<<<<<<< HEAD
<<<<<<< HEAD
const Event = require("../generated/Event.js");
=======
const { fireAnEvent } = require("../helpers/events");
>>>>>>> 782567c486993431d88a7d42ed2c18702ecdfd4f
=======
const Event = require("../generated/Event.js");
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e

const HTMLElementImpl = require("./HTMLElement-impl").implementation;

class HTMLDetailsElementImpl extends HTMLElementImpl {
  constructor(args, privateData) {
    super(args, privateData);

    this._taskQueue = null;
  }

  _dispatchToggleEvent() {
    this._taskQueue = null;

<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
    this._dispatch(Event.createImpl(
      [
        "toggle",
        { bubbles: false, cancelable: false }
      ],
      { isTrusted: true }
    ));
<<<<<<< HEAD
=======
    fireAnEvent("toggle", this);
>>>>>>> 782567c486993431d88a7d42ed2c18702ecdfd4f
=======
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
  }

  _attrModified(name, value, oldValue) {
    super._attrModified(name, value, oldValue);

    if (name === "open" && this._taskQueue === null) {
      // Check that the attribute is added or removed, not merely changed
      if ((value !== oldValue && value !== null && oldValue === null) ||
          (value === null && oldValue !== null)) {
        this._taskQueue = setTimeout(this._dispatchToggleEvent.bind(this), 0);
      }
    }
  }
}

module.exports = {
  implementation: HTMLDetailsElementImpl
};
