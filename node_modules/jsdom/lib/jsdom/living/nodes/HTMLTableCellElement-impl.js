"use strict";

const HTMLElementImpl = require("./HTMLElement-impl").implementation;

const { asciiLowercase } = require("../helpers/strings");
const { closest } = require("../helpers/traversal");

function reflectedAttributeClampedToRange(attrValue, min, max, defaultValue = 0) {
  if (attrValue === null) {
    return defaultValue;
  }
  // We don't allow hexadecimal numbers here.
  // eslint-disable-next-line radix
  const parsed = parseInt(attrValue, 10);
  if (isNaN(parsed) || parsed < 0) {
    return defaultValue;
  }
  if (parsed < min) {
    return min;
  }
  if (parsed > max) {
    return max;
  }
  return parsed;
}

class HTMLTableCellElementImpl extends HTMLElementImpl {
  get colSpan() {
<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
    return reflectedAttributeClampedToRange(this.getAttribute("colspan"), 1, 1000, 1);
  }

  set colSpan(V) {
    this.setAttribute("colspan", String(V));
  }

  get rowSpan() {
    return reflectedAttributeClampedToRange(this.getAttribute("rowspan"), 0, 65534, 1);
  }

  set rowSpan(V) {
    this.setAttribute("rowspan", String(V));
<<<<<<< HEAD
=======
    return reflectedAttributeClampedToRange(this.getAttributeNS(null, "colspan"), 1, 1000, 1);
  }

  set colSpan(V) {
    this.setAttributeNS(null, "colspan", String(V));
  }

  get rowSpan() {
    return reflectedAttributeClampedToRange(this.getAttributeNS(null, "rowspan"), 0, 65534, 1);
  }

  set rowSpan(V) {
    this.setAttributeNS(null, "rowspan", String(V));
>>>>>>> 782567c486993431d88a7d42ed2c18702ecdfd4f
=======
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
  }

  get cellIndex() {
    const tr = closest(this, "tr");
    if (tr === null) {
      return -1;
    }

    return tr.cells.indexOf(this);
  }

  get scope() {
<<<<<<< HEAD
<<<<<<< HEAD
    let value = this.getAttribute("scope");
=======
    let value = this.getAttributeNS(null, "scope");
>>>>>>> 782567c486993431d88a7d42ed2c18702ecdfd4f
=======
    let value = this.getAttribute("scope");
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
    if (value === null) {
      return "";
    }

    // Enumerated attribute is matched ASCII-case-insensitively.
    value = asciiLowercase(value);
    if (value === "row" || value === "col" || value === "rowgroup" || value === "colgroup") {
      return value;
    }

    return "";
  }

  set scope(V) {
<<<<<<< HEAD
<<<<<<< HEAD
    this.setAttribute("scope", V);
=======
    this.setAttributeNS(null, "scope", V);
>>>>>>> 782567c486993431d88a7d42ed2c18702ecdfd4f
=======
    this.setAttribute("scope", V);
>>>>>>> b9690f13ae0b02552662ffbd680e2069f9283c9e
  }
}

module.exports = {
  implementation: HTMLTableCellElementImpl
};
